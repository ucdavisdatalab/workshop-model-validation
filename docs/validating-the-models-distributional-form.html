<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Validating the model’s distributional form | Model validation for applied data science</title>
  <meta name="description" content="7 Validating the model’s distributional form | Model validation for applied data science" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Validating the model’s distributional form | Model validation for applied data science" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ucdavisdatalab.github.io/workshop_model_validation/" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/workshop_model_validation" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Validating the model’s distributional form | Model validation for applied data science" />
  
  
  

<meta name="author" content="Wesley Brooks" />


<meta name="date" content="2021-11-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="validating-the-models-functional-form.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Model validation for applied data science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1" data-path="basic-information.html"><a href="basic-information.html"><i class="fa fa-check"></i><b>1</b> Basic information</a>
<ul>
<li class="chapter" data-level="1.1" data-path="basic-information.html"><a href="basic-information.html#what-is-a-model"><i class="fa fa-check"></i><b>1.1</b> What is a model?</a></li>
<li class="chapter" data-level="1.2" data-path="basic-information.html"><a href="basic-information.html#what-is-model-validation"><i class="fa fa-check"></i><b>1.2</b> What is model validation?</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="basic-information.html"><a href="basic-information.html#typical-modeling-assumptions"><i class="fa fa-check"></i><b>1.2.1</b> Typical modeling assumptions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="how-to-begin.html"><a href="how-to-begin.html"><i class="fa fa-check"></i><b>2</b> How to begin?</a>
<ul>
<li class="chapter" data-level="2.1" data-path="how-to-begin.html"><a href="how-to-begin.html#examples"><i class="fa fa-check"></i><b>2.1</b> Examples</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="how-to-begin.html"><a href="how-to-begin.html#stopping-distance"><i class="fa fa-check"></i><b>2.1.1</b> Stopping distance</a></li>
<li class="chapter" data-level="2.1.2" data-path="how-to-begin.html"><a href="how-to-begin.html#breast-cancer-survival"><i class="fa fa-check"></i><b>2.1.2</b> Breast cancer survival</a></li>
<li class="chapter" data-level="2.1.3" data-path="how-to-begin.html"><a href="how-to-begin.html#covid-19-hospital-admissions"><i class="fa fa-check"></i><b>2.1.3</b> COVID-19 hospital admissions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="essential-concepts.html"><a href="essential-concepts.html"><i class="fa fa-check"></i><b>3</b> Essential concepts</a>
<ul>
<li class="chapter" data-level="3.1" data-path="essential-concepts.html"><a href="essential-concepts.html#in-sample-vs.-out-of-sample"><i class="fa fa-check"></i><b>3.1</b> In-sample vs. out-of-sample</a></li>
<li class="chapter" data-level="3.2" data-path="essential-concepts.html"><a href="essential-concepts.html#fitting-vs.-prediction"><i class="fa fa-check"></i><b>3.2</b> Fitting vs. prediction</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="model-types.html"><a href="model-types.html"><i class="fa fa-check"></i><b>4</b> Model types</a>
<ul>
<li class="chapter" data-level="4.1" data-path="model-types.html"><a href="model-types.html#logistic-regression"><i class="fa fa-check"></i><b>4.1</b> Logistic regression</a></li>
<li class="chapter" data-level="4.2" data-path="model-types.html"><a href="model-types.html#random-forest-regression"><i class="fa fa-check"></i><b>4.2</b> Random forest regression</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-splitting-systems.html"><a href="data-splitting-systems.html"><i class="fa fa-check"></i><b>5</b> Data splitting systems</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-splitting-systems.html"><a href="data-splitting-systems.html#trainvalidation-split"><i class="fa fa-check"></i><b>5.1</b> Train/validation split</a></li>
<li class="chapter" data-level="5.2" data-path="data-splitting-systems.html"><a href="data-splitting-systems.html#cross-validation"><i class="fa fa-check"></i><b>5.2</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-splitting-systems.html"><a href="data-splitting-systems.html#combining-the-two"><i class="fa fa-check"></i><b>5.2.1</b> Combining the two</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="validating-the-models-functional-form.html"><a href="validating-the-models-functional-form.html"><i class="fa fa-check"></i><b>6</b> Validating the model’s functional form</a>
<ul>
<li class="chapter" data-level="6.1" data-path="validating-the-models-functional-form.html"><a href="validating-the-models-functional-form.html#posit-a-model"><i class="fa fa-check"></i><b>6.1</b> Posit a model</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="validating-the-models-functional-form.html"><a href="validating-the-models-functional-form.html#model-form"><i class="fa fa-check"></i><b>6.1.1</b> Model form</a></li>
<li class="chapter" data-level="6.1.2" data-path="validating-the-models-functional-form.html"><a href="validating-the-models-functional-form.html#model-distribution"><i class="fa fa-check"></i><b>6.1.2</b> Model distribution</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="validating-the-models-functional-form.html"><a href="validating-the-models-functional-form.html#validate-the-assumptions"><i class="fa fa-check"></i><b>6.2</b> Validate the assumptions</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="validating-the-models-distributional-form.html"><a href="validating-the-models-distributional-form.html"><i class="fa fa-check"></i><b>7</b> Validating the model’s distributional form</a>
<ul>
<li class="chapter" data-level="7.1" data-path="validating-the-models-distributional-form.html"><a href="validating-the-models-distributional-form.html#posit-a-distribution"><i class="fa fa-check"></i><b>7.1</b> Posit a distribution</a></li>
<li class="chapter" data-level="7.2" data-path="validating-the-models-distributional-form.html"><a href="validating-the-models-distributional-form.html#validate-your-choice"><i class="fa fa-check"></i><b>7.2</b> Validate your choice</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="validating-the-models-distributional-form.html"><a href="validating-the-models-distributional-form.html#stopping-distance-1"><i class="fa fa-check"></i><b>7.2.1</b> Stopping distance</a></li>
<li class="chapter" data-level="7.2.2" data-path="validating-the-models-distributional-form.html"><a href="validating-the-models-distributional-form.html#breast-cancer-example"><i class="fa fa-check"></i><b>7.2.2</b> Breast cancer example</a></li>
<li class="chapter" data-level="7.2.3" data-path="validating-the-models-distributional-form.html"><a href="validating-the-models-distributional-form.html#covid-admissions-example"><i class="fa fa-check"></i><b>7.2.3</b> COVID admissions example</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Model validation for applied data science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="validating-the-models-distributional-form" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Validating the model’s distributional form</h1>
<p>Assuming a form of distribution for the data is not only about allowing the model estimation software to run. It it also necessary before we can create confidence intervals for our predictions. First we will posit a particular distribution for the responses, and then we will validate it. The validation step means that we will reject the posited distribution if it doesn’t agree with the observed data.</p>
<div id="posit-a-distribution" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Posit a distribution</h2>
<p>Recall that we already did this for the examples. This work proceeds by intuition gained through experience, but is often not particularly difficult. We already talked about the allowable range of the responses, and how to interpret those for the mean.</p>
</div>
<div id="validate-your-choice" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Validate your choice</h2>
<p>Compare the difference between the predicted and observed values to what you assume you would see, based on the posited distribution. Let’s look at the examples.</p>
<div id="stopping-distance-1" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Stopping distance</h3>
<p>I’ve said that the stopping distance example should use a normal distribution, so let’s look now to see how well the model matches that distribution. Now we can look at the in-sample error distribution as well as the out-of-sample error distribution, since unlike the mean, the linear assumption doesn’t enforce the response distribution.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="validating-the-models-distributional-form.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate a model for stopping distance</span></span>
<span id="cb34-2"><a href="validating-the-models-distributional-form.html#cb34-2" aria-hidden="true" tabindex="-1"></a>stop <span class="ot">=</span> <span class="fu">lm</span>( dist <span class="sc">~</span> speed <span class="sc">+</span> <span class="fu">I</span>(speed<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="dv">0</span>, <span class="at">data=</span>cars )</span>
<span id="cb34-3"><a href="validating-the-models-distributional-form.html#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="validating-the-models-distributional-form.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the four diagnostic plots on a 2x2 grid:</span></span>
<span id="cb34-5"><a href="validating-the-models-distributional-form.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb34-6"><a href="validating-the-models-distributional-form.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stop)</span></code></pre></div>
<p><img src="05_comparing-variance_files/figure-html/cars-diagnostic-plots-1.png" width="672" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="validating-the-models-distributional-form.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the best fit line and confidence/predictive intervals</span></span>
<span id="cb35-2"><a href="validating-the-models-distributional-form.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="do">## to begin, define the inputs for the annotations</span></span>
<span id="cb35-3"><a href="validating-the-models-distributional-form.html#cb35-3" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">=</span> <span class="fu">data.frame</span>( <span class="at">speed=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">25</span>, <span class="at">length.out=</span><span class="dv">200</span>) )</span>
<span id="cb35-4"><a href="validating-the-models-distributional-form.html#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="validating-the-models-distributional-form.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="do">## now plot the data points</span></span>
<span id="cb35-6"><a href="validating-the-models-distributional-form.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cars)</span>
<span id="cb35-7"><a href="validating-the-models-distributional-form.html#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="validating-the-models-distributional-form.html#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="do">## add the best-fit line</span></span>
<span id="cb35-9"><a href="validating-the-models-distributional-form.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>speed, <span class="fu">predict</span>(stop, xx))</span>
<span id="cb35-10"><a href="validating-the-models-distributional-form.html#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="validating-the-models-distributional-form.html#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="do">## add lines to show the confidence interval for the best-fit line</span></span>
<span id="cb35-12"><a href="validating-the-models-distributional-form.html#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>speed, <span class="fu">predict</span>(stop, xx, <span class="at">interval=</span><span class="st">&quot;confidence&quot;</span>)[, <span class="dv">2</span>], <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb35-13"><a href="validating-the-models-distributional-form.html#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>speed, <span class="fu">predict</span>(stop, xx, <span class="at">interval=</span><span class="st">&quot;confidence&quot;</span>)[, <span class="dv">3</span>], <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb35-14"><a href="validating-the-models-distributional-form.html#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="validating-the-models-distributional-form.html#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="do">## add lines to show a prediction interval for new data points</span></span>
<span id="cb35-16"><a href="validating-the-models-distributional-form.html#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>speed, <span class="fu">predict</span>(stop, xx, <span class="at">interval=</span><span class="st">&quot;prediction&quot;</span>)[, <span class="dv">2</span>], <span class="at">lty=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&#39;darkorange&#39;</span>)</span>
<span id="cb35-17"><a href="validating-the-models-distributional-form.html#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>speed, <span class="fu">predict</span>(stop, xx, <span class="at">interval=</span><span class="st">&quot;prediction&quot;</span>)[, <span class="dv">3</span>], <span class="at">lty=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&#39;darkorange&#39;</span>)</span></code></pre></div>
<p><img src="05_comparing-variance_files/figure-html/cars-intervals-1.png" width="672" /></p>
<p>The plot reveals obvious problems: the prediction intervals include negative distances, and it doesn’t account for the pattern where the stopping distances are more variable at greater speeds. So, the distribution assumed by the model doesn’t match the distribution of the data.</p>
<p>One way of addressing these problems is to implement a transformation that will make the relationship linear. Either a log or a square root transformation would work here, and the square root fits better with the model form that we’ve assumed. So let’s implement it:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="validating-the-models-distributional-form.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># take the square root of both sides of the model formula</span></span>
<span id="cb36-2"><a href="validating-the-models-distributional-form.html#cb36-2" aria-hidden="true" tabindex="-1"></a>stop_xfrm <span class="ot">=</span> <span class="fu">lm</span>( <span class="fu">sqrt</span>(dist) <span class="sc">~</span> <span class="fu">sqrt</span>(speed) <span class="sc">+</span> speed <span class="sc">+</span> <span class="dv">0</span>, <span class="at">data=</span>cars )</span>
<span id="cb36-3"><a href="validating-the-models-distributional-form.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="validating-the-models-distributional-form.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the diagnostic plots on a 2x2 grid</span></span>
<span id="cb36-5"><a href="validating-the-models-distributional-form.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>( <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb36-6"><a href="validating-the-models-distributional-form.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stop_xfrm)</span></code></pre></div>
<p><img src="05_comparing-variance_files/figure-html/cars-diagnostic-plots-transformed-1.png" width="672" /></p>
<p>The Q-Q plot is greatly improved over the first version, which says that the residuals more closely match the assumption of normality.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="validating-the-models-distributional-form.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the dat points</span></span>
<span id="cb37-2"><a href="validating-the-models-distributional-form.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cars)</span>
<span id="cb37-3"><a href="validating-the-models-distributional-form.html#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="validating-the-models-distributional-form.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="do">## add the best-fit line</span></span>
<span id="cb37-5"><a href="validating-the-models-distributional-form.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>speed, <span class="fu">predict</span>(stop_xfrm, xx)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb37-6"><a href="validating-the-models-distributional-form.html#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="validating-the-models-distributional-form.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="do">## add lines to show the confidence interval for the best-fit line</span></span>
<span id="cb37-8"><a href="validating-the-models-distributional-form.html#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>speed, <span class="fu">predict</span>(stop_xfrm, xx, <span class="at">interval=</span><span class="st">&quot;confidence&quot;</span>)[, <span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb37-9"><a href="validating-the-models-distributional-form.html#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>speed, <span class="fu">predict</span>(stop_xfrm, xx, <span class="at">interval=</span><span class="st">&quot;confidence&quot;</span>)[, <span class="dv">3</span>]<span class="sc">^</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb37-10"><a href="validating-the-models-distributional-form.html#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="validating-the-models-distributional-form.html#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="do">## add lines to show a prediction interval for new data points</span></span>
<span id="cb37-12"><a href="validating-the-models-distributional-form.html#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>speed, <span class="fu">predict</span>(stop_xfrm, xx, <span class="at">interval=</span><span class="st">&quot;prediction&quot;</span>)[, <span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&#39;darkorange&#39;</span>)</span>
<span id="cb37-13"><a href="validating-the-models-distributional-form.html#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx<span class="sc">$</span>speed, <span class="fu">predict</span>(stop_xfrm, xx, <span class="at">interval=</span><span class="st">&quot;prediction&quot;</span>)[, <span class="dv">3</span>]<span class="sc">^</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&#39;darkorange&#39;</span>)</span></code></pre></div>
<p><img src="05_comparing-variance_files/figure-html/cars-intervals-transformed-1.png" width="672" /></p>
<p>The happy result is a model where the mean predictions are about the same as before, but the predictive interval is a better match to the data.</p>
</div>
<div id="breast-cancer-example" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Breast cancer example</h3>
<p>We used logistic regression to create a model for five year survival among women in the German Breast Cancer Study Group. To validate the assumption of a binomial distribution with a logistic link, we will bin predictions into groups that have similar predicted probability of survival, and then check that the observed frequency of survival in each bin follows the assumed binomial distribution.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="validating-the-models-distributional-form.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># divide the predictions into twenty bins (nineteen breakpoints)</span></span>
<span id="cb38-2"><a href="validating-the-models-distributional-form.html#cb38-2" aria-hidden="true" tabindex="-1"></a>q_gbsg <span class="ot">=</span> <span class="fu">quantile</span>( pred_gbsg, <span class="fu">seq</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="at">length.out=</span><span class="dv">19</span>) )</span>
<span id="cb38-3"><a href="validating-the-models-distributional-form.html#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="validating-the-models-distributional-form.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add 0 and 1 as the extremes of the probabilities</span></span>
<span id="cb38-5"><a href="validating-the-models-distributional-form.html#cb38-5" aria-hidden="true" tabindex="-1"></a>q_gbsg <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, q_gbsg, <span class="dv">1</span>)</span>
<span id="cb38-6"><a href="validating-the-models-distributional-form.html#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="validating-the-models-distributional-form.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create some variables to hold the observed, expected five-year survival</span></span>
<span id="cb38-8"><a href="validating-the-models-distributional-form.html#cb38-8" aria-hidden="true" tabindex="-1"></a>p_gbsg <span class="ot">=</span> <span class="fu">numeric</span>(<span class="dv">20</span>)</span>
<span id="cb38-9"><a href="validating-the-models-distributional-form.html#cb38-9" aria-hidden="true" tabindex="-1"></a>fys_gbsg <span class="ot">=</span> <span class="fu">numeric</span>(<span class="dv">20</span>)</span>
<span id="cb38-10"><a href="validating-the-models-distributional-form.html#cb38-10" aria-hidden="true" tabindex="-1"></a>tot_gbsg <span class="ot">=</span> <span class="fu">numeric</span>(<span class="dv">20</span>) </span>
<span id="cb38-11"><a href="validating-the-models-distributional-form.html#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="validating-the-models-distributional-form.html#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate expected and observed five-year survival in each bin</span></span>
<span id="cb38-13"><a href="validating-the-models-distributional-form.html#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb38-14"><a href="validating-the-models-distributional-form.html#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># identify which predictions are within this interval</span></span>
<span id="cb38-15"><a href="validating-the-models-distributional-form.html#cb38-15" aria-hidden="true" tabindex="-1"></a>  indx <span class="ot">=</span> pred_gbsg <span class="sc">&gt;</span> q_gbsg[[i]] <span class="sc">&amp;</span> pred_gbsg <span class="sc">&lt;=</span> q_gbsg[[i<span class="sc">+</span><span class="dv">1</span>]]</span>
<span id="cb38-16"><a href="validating-the-models-distributional-form.html#cb38-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-17"><a href="validating-the-models-distributional-form.html#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the mean probability within this interval</span></span>
<span id="cb38-18"><a href="validating-the-models-distributional-form.html#cb38-18" aria-hidden="true" tabindex="-1"></a>  p_gbsg[[i]] <span class="ot">=</span> <span class="fu">mean</span>(pred_gbsg[ indx ], <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb38-19"><a href="validating-the-models-distributional-form.html#cb38-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-20"><a href="validating-the-models-distributional-form.html#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the number of subects in this interval who survived five years</span></span>
<span id="cb38-21"><a href="validating-the-models-distributional-form.html#cb38-21" aria-hidden="true" tabindex="-1"></a>  fys_gbsg[[i]] <span class="ot">=</span> <span class="fu">sum</span>( gbsg<span class="sc">$</span>fys[ indx ], <span class="at">na.rm=</span><span class="cn">TRUE</span> )</span>
<span id="cb38-22"><a href="validating-the-models-distributional-form.html#cb38-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-23"><a href="validating-the-models-distributional-form.html#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the number of subjects in this interval</span></span>
<span id="cb38-24"><a href="validating-the-models-distributional-form.html#cb38-24" aria-hidden="true" tabindex="-1"></a>  tot_gbsg[[i]] <span class="ot">=</span> <span class="fu">sum</span>( <span class="sc">!</span><span class="fu">is.na</span>(gbsg<span class="sc">$</span>fys)[ indx ] )</span>
<span id="cb38-25"><a href="validating-the-models-distributional-form.html#cb38-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-26"><a href="validating-the-models-distributional-form.html#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="validating-the-models-distributional-form.html#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, calculate whether the observed five-year survival matches the predictions</span></span>
<span id="cb38-28"><a href="validating-the-models-distributional-form.html#cb38-28" aria-hidden="true" tabindex="-1"></a>bins <span class="ot">=</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="cf">function</span>(k) <span class="fu">pbinom</span>( fys_gbsg[[k]], tot_gbsg[[k]], p_gbsg[[k]] ) )</span>
<span id="cb38-29"><a href="validating-the-models-distributional-form.html#cb38-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-30"><a href="validating-the-models-distributional-form.html#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of the bin probabilities</span></span>
<span id="cb38-31"><a href="validating-the-models-distributional-form.html#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>( bins, <span class="at">breaks=</span><span class="dv">10</span> )</span></code></pre></div>
<p><img src="05_comparing-variance_files/figure-html/binomial-cv-1.png" width="672" /></p>
<p>The histogram shows that the likelihoods of the observed data are clustered near the extremes (0 and 1). If the observations match the assumed binomial distribution, then we would expect likelihoods to be uniformly distributed between zero and one (no clustering). So this model for the five year survival probability should not pass validation - it needs more work.</p>
</div>
<div id="covid-admissions-example" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> COVID admissions example</h3>
<p>Since each day’s prediction is assumed to come from a Poisson distribution, that assumption defines an expected range for the observed data. The <code>qpois()</code>, <code>dpois()</code>, <code>ppois()</code> family of functions is used for this purpose.</p>
<p>Here, we will validate the assumed Poisson distribution by calculating the frequency that the observed data is within the predicted 80% confidence interval. If the nominal coverage is correct, the frequency should be about 80%.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="validating-the-models-distributional-form.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="validating-the-models-functional-form.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/workshop_model_validation/edit/master/05_comparing-variance.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/workshop_model_validation/blob/master/05_comparing-variance.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
